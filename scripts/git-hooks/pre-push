#!/bin/bash

echo "Running pre-push checks..."

# Run Spotless with auto-fix
echo "Checking and fixing code formatting with Spotless..."
./gradlew spotlessApply --daemon --quiet

if [ $? -ne 0 ]; then
    echo ""
    echo "❌ Spotless apply failed!"
    echo ""
    exit 1
fi

# Run Detekt
echo "Running static analysis with Detekt..."
./gradlew detekt --daemon --quiet

if [ $? -ne 0 ]; then
    echo ""
    echo "❌ Detekt check failed!"
    echo "Fix the issues reported above before pushing."
    echo ""
    exit 1
fi

echo "✅ All pre-push checks passed!"
exit 0
